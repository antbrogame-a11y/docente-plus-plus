<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web app per la gestione della didattica dell'insegnante potenziata da IA OpenRouter">
    <meta name="theme-color" content="#4a90e2">
    <title>Docente++ - Gestione Didattica con IA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons for iOS & PWA -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Docente++">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    
    <!-- Material Design Icons -->
    <link href="fonts/material-icons.css" rel="stylesheet">
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <!-- Roboto Font -->
    <link href="fonts/roboto.css" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <!-- Note: PDF/Excel/ZIP libraries can be loaded dynamically when needed to avoid ES6 module conflicts -->
    <!--
    <script>
        // Dynamically load third-party libraries to avoid ES6 module strict mode conflicts
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Load libraries after DOM is ready
        window.addEventListener('DOMContentLoaded', () => {
            Promise.all([
                loadScript('libs/papaparse.min.js'),
                loadScript('libs/jszip.min.js'),
                loadScript('libs/jspdf.umd.min.js').then(() => loadScript('libs/jspdf.plugin.autotable.min.js')),
                loadScript('libs/xlsx.full.min.js')
            ]).catch(err => console.error('Error loading libraries:', err));
        });
    </script>
    -->
</head>
<body>
    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Benvenuto in Docente++</h2>
            <p>Configura il tuo profilo per iniziare</p>
            <form id="onboarding-form">
                <div class="form-group">
                    <label for="onboarding-first-name">Nome *</label>
                    <input type="text" id="onboarding-first-name" required>
                </div>
                <div class="form-group">
                    <label for="onboarding-last-name">Cognome</label>
                    <input type="text" id="onboarding-last-name">
                </div>
                <div class="form-group">
                    <label for="onboarding-school-year">Anno Scolastico</label>
                    <input type="text" id="onboarding-school-year" placeholder="2024/2025">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Inizia ad Usare Docente++</button>
                    <button type="button" id="onboarding-skip" class="btn btn-secondary">Salta per Ora</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Header -->
    <header>
        <div class="header-content">
            <button id="menu-toggle" class="menu-toggle">☰</button>
            <h1>Docente++</h1>
            <div class="header-actions">
                <button id="theme-picker-btn" class="icon-btn" title="Cambia tema">
                    <span class="material-symbols-outlined">palette</span>
                </button>
                <div id="active-class-badge">
                    <span id="active-class-badge-text">Workspace</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Menu Backdrop for Mobile -->
    <div id="menu-backdrop" class="menu-backdrop"></div>

    <!-- Main Navigation -->
    <nav id="main-nav">
        <button class="tab-button" data-tab="home">
            <span class="material-symbols-outlined">home</span>
            <span class="tab-label">Dashboard</span>
        </button>
        <button class="tab-button" data-tab="lessons">
            <span class="material-symbols-outlined">menu_book</span>
            <span class="tab-label">Lezioni</span>
        </button>
        <button class="tab-button" data-tab="students">
            <span class="material-symbols-outlined">group</span>
            <span class="tab-label">Studenti</span>
        </button>
        <button class="tab-button" data-tab="classes">
            <span class="material-symbols-outlined">school</span>
            <span class="tab-label">Classi</span>
        </button>
        <button class="tab-button" data-tab="activities">
            <span class="material-symbols-outlined">assignment</span>
            <span class="tab-label">Attività</span>
        </button>
        <button class="tab-button" data-tab="evaluations">
            <span class="material-symbols-outlined">bar_chart</span>
            <span class="tab-label">Valutazioni</span>
        </button>
        <button class="tab-button" data-tab="schedule">
            <span class="material-symbols-outlined">calendar_month</span>
            <span class="tab-label">Orario</span>
        </button>
        <button class="tab-button" data-tab="aiAssistant">
            <span class="material-symbols-outlined">psychology</span>
            <span class="tab-label">Assistente IA</span>
        </button>
        <button class="tab-button" data-tab="documentImport">
            <span class="material-symbols-outlined">upload_file</span>
            <span class="tab-label">Importa Documenti</span>
        </button>
        
        <div class="menu-group">
            <button class="menu-with-submenu">
                <span class="material-symbols-outlined">more_horiz</span>
                <span class="tab-label">Altro</span>
            </button>
            <div class="submenu">
                <button class="submenu-item tab-button" data-tab="settings">
                    <span class="material-symbols-outlined">settings</span>
                    <span class="tab-label">Impostazioni</span>
                </button>
                <button class="submenu-item tab-button" data-tab="backupRestore">
                    <span class="material-symbols-outlined">backup</span>
                    <span class="tab-label">Backup/Ripristino</span>
                </button>
                <button class="submenu-item tab-button" data-tab="help">
                    <span class="material-symbols-outlined">help</span>
                    <span class="tab-label">Aiuto</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main>
        <!-- Home Tab -->
        <div id="home" class="tab-content">
            <h2>Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Lezioni</h3>
                    <p id="home-lesson-count">0</p>
                </div>
                <div class="stat-card">
                    <h3>Studenti</h3>
                    <p id="home-student-count">0</p>
                </div>
                <div class="stat-card">
                    <h3>Attività</h3>
                    <p id="home-activity-count">0</p>
                </div>
                <div class="stat-card">
                    <h3>Valutazioni</h3>
                    <p id="home-evaluation-count">0</p>
                </div>
            </div>
            
            <div class="dashboard-section">
                <h3>Orario di Oggi</h3>
                <div id="today-schedule-enhanced"></div>
            </div>
            
            <div class="dashboard-section">
                <h3>Cose da Fare</h3>
                <div id="things-todo-list"></div>
            </div>
            
            <div class="dashboard-section">
                <h3>Suggerimenti IA</h3>
                <div id="ai-suggestions-content"></div>
                <div>Stato IA: <span id="home-ai-ready">Non configurata</span></div>
            </div>
        </div>

        <!-- Lessons Tab -->
        <div id="lessons" class="tab-content">
            <h2>Gestione Lezioni</h2>
            <button class="btn btn-primary" onclick="window.app.newLesson()">
                <span class="material-symbols-outlined">add</span>
                Nuova Lezione
            </button>
            <div id="lessons-list"></div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <h2>Gestione Studenti</h2>
            <div style="margin-bottom: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="window.app.newStudent()">
                    <span class="material-symbols-outlined">person_add</span>
                    Nuovo Studente
                </button>
                <button class="btn btn-secondary" onclick="window.app.exportStudentsCSV()">
                    <span class="material-symbols-outlined">download</span>
                    Esporta CSV
                </button>
                <label class="btn btn-secondary" style="cursor: pointer;">
                    <span class="material-symbols-outlined">upload</span>
                    Importa CSV
                    <input type="file" id="import-csv-input" accept=".csv" style="display:none;" onchange="window.app.importStudentsCSV(this.files[0])">
                </label>
            </div>
            <div id="students-list"></div>
        </div>

        <!-- Classes Tab -->
        <div id="classes" class="tab-content">
            <h2>Gestione Classi</h2>
            <button class="btn btn-primary" onclick="window.app.newClass()">
                <span class="material-symbols-outlined">add</span>
                Nuova Classe
            </button>
            <div id="classes-list"></div>
        </div>

        <!-- Activities Tab -->
        <div id="activities" class="tab-content">
            <h2>Gestione Attività</h2>
            <button class="btn btn-primary" onclick="window.app.newActivity()">
                <span class="material-symbols-outlined">add</span>
                Nuova Attività
            </button>
            <div id="activities-list"></div>
        </div>

        <!-- Evaluations Tab -->
        <div id="evaluations" class="tab-content">
            <h2>Gestione Valutazioni</h2>
            <button class="btn btn-primary" onclick="window.app.newEvaluation()">
                <span class="material-symbols-outlined">add</span>
                Nuova Valutazione
            </button>
            <div id="evaluations-list"></div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content">
            <h2>Orario Settimanale</h2>
            <div id="schedule-view"></div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="aiAssistant" class="tab-content">
            <h2>Assistente IA</h2>
            <div id="ai-chat-container">
                <div id="ai-chat-messages"></div>
                <div class="ai-chat-input-area">
                    <input type="text" id="ai-chat-input" placeholder="Chiedimi qualcosa...">
                    <button id="ai-chat-send">Invia</button>
                </div>
            </div>
        </div>

        <!-- Document Import Tab -->
        <div id="documentImport" class="tab-content">
            <h2>Importa Documenti</h2>
            <div class="import-area">
                <input type="file" id="pdf-upload" accept=".pdf,.txt,.csv,.xlsx,.json">
                <label for="pdf-upload">Carica un documento</label>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Impostazioni</h2>
            <div class="settings-section">
                <h3>Profilo Docente</h3>
                <p>Nome: <span id="settings-teacher-name">-</span></p>
                <p>Anno Scolastico: <span id="settings-school-year">-</span></p>
            </div>
            <div class="settings-section">
                <h3>Risoluzione Problemi</h3>
                <button id="clear-all-data-btn" class="btn btn-danger">Cancella Tutti i Dati</button>
                <p class="help-text">⚠️ Questa azione cancellerà tutti i tuoi dati salvati e ripristinerà l'app.</p>
            </div>
        </div>

        <!-- Backup/Restore Tab -->
        <div id="backupRestore" class="tab-content">
            <h2>Backup e Ripristino</h2>
            <div class="backup-section">
                <button class="btn btn-primary">Esporta Backup</button>
                <button class="btn btn-secondary">Importa Backup</button>
            </div>
        </div>

        <!-- Help Tab -->
        <div id="help" class="tab-content">
            <h2>Aiuto</h2>
            <div class="help-section">
                <h3>Guide Rapide</h3>
                <ul>
                    <li>Come creare una nuova classe</li>
                    <li>Come aggiungere studenti</li>
                    <li>Come pianificare lezioni</li>
                    <li>Come utilizzare l'assistente IA</li>
                </ul>
                
                <h3>Risoluzione Problemi</h3>
                <p>Se l'app non funziona correttamente:</p>
                <ol>
                    <li>Prova a ricaricare la pagina (F5)</li>
                    <li>Controlla la console del browser per errori</li>
                    <li>Se i dati sono corrotti, vai in Impostazioni e usa "Cancella Tutti i Dati"</li>
                    <li>Assicurati che il localStorage del browser sia abilitato</li>
                </ol>
                
                <h3>Informazioni</h3>
                <p>Docente++ v1.1.0 (Refactored)</p>
                <p>App web per la gestione della didattica</p>
            </div>
        </div>
    </main>

    <!-- Class Modal -->
    <div id="class-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Classe</h2>
            <form id="class-modal-form">
                <div class="form-group">
                    <label for="class-modal-name">Nome Classe *</label>
                    <input type="text" id="class-modal-name" name="name" required placeholder="es. 3A, 5B">
                </div>
                <div class="form-group">
                    <label for="class-modal-schoolYear">Anno Scolastico</label>
                    <input type="text" id="class-modal-schoolYear" name="schoolYear" placeholder="es. 2024/2025">
                </div>
                <div class="form-group">
                    <label for="class-modal-description">Descrizione</label>
                    <textarea id="class-modal-description" name="description" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('class-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Student Modal -->
    <div id="student-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Studente</h2>
            <form id="student-modal-form">
                <div class="form-group">
                    <label for="student-modal-firstName">Nome *</label>
                    <input type="text" id="student-modal-firstName" name="firstName" required>
                </div>
                <div class="form-group">
                    <label for="student-modal-lastName">Cognome *</label>
                    <input type="text" id="student-modal-lastName" name="lastName" required>
                </div>
                <div class="form-group">
                    <label for="student-modal-email">Email</label>
                    <input type="email" id="student-modal-email" name="email">
                </div>
                <div class="form-group">
                    <label for="student-modal-classId">Classe</label>
                    <select id="student-modal-classId" name="classId">
                        <option value="">-- Nessuna classe --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="student-modal-birthDate">Data di Nascita</label>
                    <input type="date" id="student-modal-birthDate" name="birthDate">
                </div>
                <div class="form-group">
                    <label for="student-modal-notes">Note</label>
                    <textarea id="student-modal-notes" name="notes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('student-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lesson Modal -->
    <div id="lesson-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Lezione</h2>
            <form id="lesson-modal-form">
                <div class="form-group">
                    <label for="lesson-modal-title">Titolo *</label>
                    <input type="text" id="lesson-modal-title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="lesson-modal-subject">Materia *</label>
                    <select id="lesson-modal-subject" name="subject" required>
                        <option value="">-- Seleziona --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lesson-modal-date">Data *</label>
                    <input type="date" id="lesson-modal-date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="lesson-modal-time">Ora</label>
                    <input type="time" id="lesson-modal-time" name="time" value="09:00">
                </div>
                <div class="form-group">
                    <label for="lesson-modal-classId">Classe</label>
                    <select id="lesson-modal-classId" name="classId">
                        <option value="">-- Nessuna classe --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="lesson-modal-description">Descrizione</label>
                    <textarea id="lesson-modal-description" name="description" rows="4"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('lesson-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Activity Modal -->
    <div id="activity-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Attività</h2>
            <form id="activity-modal-form">
                <div class="form-group">
                    <label for="activity-modal-title">Titolo *</label>
                    <input type="text" id="activity-modal-title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="activity-modal-type">Tipo *</label>
                    <select id="activity-modal-type" name="type" required>
                        <option value="">-- Seleziona --</option>
                        <option value="Compito">Compito</option>
                        <option value="Verifica">Verifica</option>
                        <option value="Progetto">Progetto</option>
                        <option value="Laboratorio">Laboratorio</option>
                        <option value="Esercitazione">Esercitazione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="activity-modal-date">Data *</label>
                    <input type="date" id="activity-modal-date" name="date" required>
                </div>
                <div class="form-group">
                    <label for="activity-modal-status">Stato</label>
                    <select id="activity-modal-status" name="status">
                        <option value="pianificata">Pianificata</option>
                        <option value="in corso">In corso</option>
                        <option value="completata">Completata</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="activity-modal-classId">Classe</label>
                    <select id="activity-modal-classId" name="classId">
                        <option value="">-- Nessuna classe --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="activity-modal-description">Descrizione</label>
                    <textarea id="activity-modal-description" name="description" rows="4"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('activity-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Evaluation Modal -->
    <div id="evaluation-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Valutazione</h2>
            <form id="evaluation-modal-form">
                <div class="form-group">
                    <label for="evaluation-modal-studentId">Studente *</label>
                    <select id="evaluation-modal-studentId" name="studentId" required>
                        <option value="">-- Seleziona --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="evaluation-modal-activityId">Attività *</label>
                    <select id="evaluation-modal-activityId" name="activityId" required>
                        <option value="">-- Seleziona --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="evaluation-modal-grade">Voto</label>
                    <input type="text" id="evaluation-modal-grade" name="grade" placeholder="es. 8, 9/10, Ottimo">
                </div>
                <div class="form-group">
                    <label for="evaluation-modal-date">Data</label>
                    <input type="date" id="evaluation-modal-date" name="date">
                </div>
                <div class="form-group">
                    <label for="evaluation-modal-comment">Commento</label>
                    <textarea id="evaluation-modal-comment" name="comment" rows="4"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('evaluation-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Theme Picker Dialog -->
    <div id="theme-picker-dialog" class="modal theme-picker-modal" style="display: none;">
        <div class="modal-content theme-picker-content">
            <h2>Scegli Tema</h2>
            <form id="theme-picker-form">
                <div class="theme-options">
                    <label class="theme-option">
                        <input type="radio" name="theme" value="light" id="theme-light">
                        <span class="theme-option-content">
                            <span class="material-symbols-outlined">light_mode</span>
                            <span class="theme-option-text">
                                <strong>Chiaro</strong>
                                <small>Tema luminoso per ambienti ben illuminati</small>
                            </span>
                        </span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="dark" id="theme-dark">
                        <span class="theme-option-content">
                            <span class="material-symbols-outlined">dark_mode</span>
                            <span class="theme-option-text">
                                <strong>Scuro</strong>
                                <small>Tema scuro per ridurre l'affaticamento degli occhi</small>
                            </span>
                        </span>
                    </label>
                    <label class="theme-option">
                        <input type="radio" name="theme" value="auto" id="theme-auto" checked>
                        <span class="theme-option-content">
                            <span class="material-symbols-outlined">contrast</span>
                            <span class="theme-option-text">
                                <strong>Automatico (Dinamico)</strong>
                                <small>Segue le impostazioni del sistema operativo</small>
                            </span>
                        </span>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="theme-cancel-btn">Annulla</button>
                    <button type="submit" class="btn btn-primary" id="theme-apply-btn">Applica</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="app.js"></script>

</body>
</html>