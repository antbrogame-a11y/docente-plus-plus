<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web app per la gestione della didattica dell'insegnante potenziata da IA OpenRouter">
    <meta name="theme-color" content="#4a90e2">
    <title>Docente++ - Gestione Didattica con IA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons for iOS & PWA -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Docente++">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    
    <!-- Material Design Icons -->
    <link href="fonts/material-icons.css" rel="stylesheet">
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <!-- Roboto Font -->
    <link href="fonts/roboto.css" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <!-- MD3 Theme Styles -->
    <link rel="stylesheet" href="src/styles/generated-md3-expressive.css">
    <link rel="stylesheet" href="src/styles/theme-md3-expressive.css">
    <!-- Common Page Styles -->
    <link rel="stylesheet" href="src/styles/common-page.css">
    <!-- Theme Switcher Component -->
    <link rel="stylesheet" href="src/components/ThemeSwitcher.css">
    <!-- Schedule Component Styles -->
    <link rel="stylesheet" href="css/schedule-theme.css">
    <link rel="stylesheet" href="css/schedule-component.css">
    <!-- Import System Styles -->
    <link rel="stylesheet" href="css/import-system.css">
    <!-- Floating AI Assistant Styles -->
    <link rel="stylesheet" href="css/floating-assistant.css">
    
    <!-- Third-party libraries for document processing -->
    <script src="libs/papaparse.min.js"></script>
    <!-- PDF.js for PDF text extraction -->
    <script src="libs/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'libs/pdf.worker.js';
    </script>
    <!-- JSZip for backup ZIP creation -->
    <script src="libs/jszip.min.js"></script>
    
    <!-- Note: PDF/Excel/ZIP libraries can be loaded dynamically when needed to avoid ES6 module conflicts -->
    <!--
    <script>
        // Dynamically load third-party libraries to avoid ES6 module strict mode conflicts
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Load libraries after DOM is ready
        window.addEventListener('DOMContentLoaded', () => {
            Promise.all([
                loadScript('libs/papaparse.min.js'),
                loadScript('libs/jszip.min.js'),
                loadScript('libs/jspdf.umd.min.js').then(() => loadScript('libs/jspdf.plugin.autotable.min.js')),
                loadScript('libs/xlsx.full.min.js')
            ]).catch(err => console.error('Error loading libraries:', err));
        });
    </script>
    -->
</head>
<body>
    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal" style="display: none;">
        <div class="modal-content onboarding-content">
            <h2><span class="material-icons">school</span> Benvenuto in Docente++</h2>
            <p>Configura il tuo profilo per iniziare.</p>
            <form id="onboarding-form">
                <!-- ... Onboarding form fields ... -->
            </form>
            <p style="margin-top: 16px; color: var(--md-text-secondary); font-size: var(--font-size-sm);">
                <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">info</span>
                Il completamento del profilo è necessario per accedere all'applicazione.
            </p>
        </div>
    </div>

    <div class="container">
        <header>
            <h1><span class="material-icons">school</span> Docente++</h1>
            <p class="subtitle">Gestione Didattica Potenziata da IA</p>
        </header>

        <div class="nav-container">
            <button class="menu-toggle" id="menu-toggle" aria-label="Menu">
                <span></span><span></span><span></span>
            </button>
            <nav class="tabs" id="main-nav">
                <button class="tab-button active" data-tab="home"><span class="material-icons">home</span> Sala Prof</button>
                <button class="tab-button" data-tab="lessons"><span class="material-icons">menu_book</span> Lezioni</button>
                <button class="tab-button" data-tab="activities"><span class="material-icons">assignment</span> Attività</button>
                <button class="tab-button" data-tab="schedule"><span class="material-icons">calendar_today</span> Orario</button>
                <button class="tab-button" data-tab="ai-assistant"><span class="material-icons">smart_toy</span> Assistente IA</button>
                <button class="tab-button" data-tab="document-import"><span class="material-icons">description</span> Importa</button>
            </nav>
        </div>

        <!-- Home Tab (Sala Prof) - NEW LAYOUT -->
        <div id="home" class="tab-content active">
            <div class="tab-header">
                <h2><span class="material-icons">home</span> Sala Prof</h2>
                <p>La tua dashboard per la giornata.</p>
            </div>
            
            <div class="home-grid">
                <!-- Main Column -->
                <div class="home-main-column">
                    <!-- Today's Schedule Card -->
                    <div class="home-card" id="home-schedule-card">
                        <div class="card-header">
                            <h3><span class="material-icons">calendar_today</span> Orario di Oggi</h3>
                            <button class="btn btn-sm btn-secondary" onclick="window.app.switchTab('schedule')">Vista completa</button>
                        </div>
                        <div id="home-today-schedule" class="card-content">
                            <!-- Dynamic content will be injected here -->
                            <p class="placeholder">Nessuna lezione programmata per oggi.</p>
                        </div>
                    </div>
                </div>

                <!-- Side Column -->
                <div class="home-side-column">
                    <!-- Things To Do Card -->
                    <div class="home-card" id="home-todo-card">
                        <div class="card-header">
                            <h3><span class="material-icons">check_circle</span> Cose da Fare</h3>
                        </div>
                        <div id="home-todo-list" class="card-content">
                             <!-- Dynamic content will be injected here -->
                            <p class="placeholder">Nessuna attività in scadenza.</p>
                        </div>
                    </div>

                    <!-- AI Suggestions Card -->
                    <div class="home-card" id="home-ai-card">
                        <div class="card-header">
                            <h3><span class="material-icons">smart_toy</span> Suggerimenti IA</h3>
                            <button class="btn btn-sm btn-icon" onclick="window.app.refreshAISuggestions()" title="Aggiorna suggerimenti">
                                <span class="material-icons">refresh</span>
                            </button>
                        </div>
                        <div id="home-ai-suggestions" class="card-content">
                            <!-- Dynamic content will be injected here -->
                            <p class="placeholder">L'IA sta pensando...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lessons Tab -->
        <div id="lessons" class="tab-content">
            <div class="tab-header">
                <h2><span class="material-icons">menu_book</span> Gestione Lezioni</h2>
            </div>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddLessonForm()"><span class="material-icons">add</span> Nuova Lezione</button>
                <button class="btn btn-secondary" onclick="app.generateLessonWithAI()"><span class="material-icons">smart_toy</span> Genera con IA</button>
            </div>
            <div id="lessons-list"></div>
        </div>

        <!-- Activities Tab -->
        <div id="activities" class="tab-content">
             <div class="tab-header">
                <h2><span class="material-icons">assignment</span> Gestione Attività</h2>
            </div>
             <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddActivityForm()"><span class="material-icons">add</span> Nuova Attività</button>
            </div>
            <div id="activities-list"></div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content">
            <div class="tab-header">
                <h2><span class="material-icons">calendar_today</span> Orario Settimanale</h2>
            </div>
            <div id="schedule-container"></div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="ai-assistant" class="tab-content">
            <div class="tab-header">
                <h2><span class="material-icons">smart_toy</span> Assistente IA</h2>
            </div>
            <div class="ai-container">
                <div class="ai-chat">
                    <div class="chat-messages" id="ai-chat-messages"></div>
                    <div class="chat-input-container">
                        <textarea id="ai-chat-input" placeholder="Chiedi qualcosa all'assistente..." rows="2"></textarea>
                        <button id="ai-chat-send" class="btn btn-primary"><span class="material-icons">send</span></button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Document Import Tab -->
        <div id="document-import" class="tab-content">
            <div class="tab-header">
                <h2><span class="material-icons">description</span> Importa da Documenti</h2>
                <p>Carica PDF per creare lezioni e attività con l'IA.</p>
            </div>
            <div class="import-container">
                <input type="file" id="pdf-upload" accept=".pdf" style="display: none;">
                <button class="btn btn-primary" onclick="document.getElementById('pdf-upload').click();">
                    <span class="material-icons">upload_file</span> Seleziona PDF
                </button>
                <div id="pdf-upload-feedback"></div>
                
                <div id="pdf-import-options" style="display: none;">
                    <h3>Elabora il documento</h3>
                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="processPdfForLessons()">
                            <span class="material-icons">menu_book</span> Crea Lezione
                        </button>
                        <button class="btn btn-secondary" onclick="processPdfForActivities()">
                            <span class="material-icons">checklist</span> Estrai Attività
                        </button>
                    </div>
                    <div id="pdf-processing-output"></div>
                </div>
            </div>
            
            <!-- Troubleshooting Section -->
            <div class="settings-section">
                <h3>🔧 Risoluzione Problemi</h3>
                <button id="clear-all-data-btn" class="btn btn-danger">
                    <span class="material-symbols-outlined">delete_forever</span>
                    Cancella Tutti i Dati
                </button>
                <p class="help-text">⚠️ Questa azione cancellerà tutti i tuoi dati salvati e ripristinerà l'app allo stato iniziale.</p>
            </div>
        </div>

        <!-- Backup/Restore Tab -->
        <div id="backupRestore" class="tab-content">
            <h2>Backup e Ripristino</h2>
            <div class="backup-section">
                <button class="btn btn-primary">Esporta Backup</button>
                <button class="btn btn-secondary">Importa Backup</button>
            </div>
        </div>

        <!-- Help Tab -->
        <div id="help" class="tab-content">
            <h2>Aiuto</h2>
            <div class="help-section">
                <h3>Guide Rapide</h3>
                <ul>
                    <li>Come creare una nuova classe</li>
                    <li>Come aggiungere studenti</li>
                    <li>Come pianificare lezioni</li>
                    <li>Come utilizzare l'assistente IA</li>
                </ul>
                
                <h3>Risoluzione Problemi</h3>
                <p>Se l'app non funziona correttamente:</p>
                <ol>
                    <li>Prova a ricaricare la pagina (F5)</li>
                    <li>Controlla la console del browser per errori</li>
                    <li>Se i dati sono corrotti, vai in Impostazioni e usa "Cancella Tutti i Dati"</li>
                    <li>Assicurati che il localStorage del browser sia abilitato</li>
                </ol>
                
                <h3>Informazioni</h3>
                <p>Docente++ v1.1.0 (Refactored)</p>
                <p>App web per la gestione della didattica</p>
            </div>
        </div>
    </main>

    <!-- Class Modal -->
    <div id="class-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Gestione Classe</h2>
            <form id="class-modal-form">
                <div class="form-group">
                    <label for="class-modal-name">Nome Classe *</label>
                    <input type="text" id="class-modal-name" name="name" required placeholder="es. 3A, 5B">
                </div>
                <div class="form-group">
                    <label for="class-modal-schoolYear">Anno Scolastico</label>
                    <input type="text" id="class-modal-schoolYear" name="schoolYear" placeholder="es. 2024/2025">
                </div>
                <div class="form-group">
                    <label for="class-modal-description">Descrizione</label>
                    <textarea id="class-modal-description" name="description" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salva</button>
                    <button type="button" class="btn btn-secondary" onclick="window.app.hideModal('class-modal')">Annulla</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="toast-container"></div>
    
    <script src="js/data.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/files.js"></script>
    <script src="js/events.js"></script>
    <script src="app.js"></script>
</body>
</html>