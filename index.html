<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web app per la gestione della didattica dell'insegnante potenziata da IA OpenRouter">
    <meta name="theme-color" content="#4a90e2">
    <title>Docente++ - Gestione Didattica con IA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Docente++">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    
    <link rel="stylesheet" href="styles.css">
    <!-- PDF and Excel Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- PDF.js for PDF text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <!-- RSS Parser for RSS/Atom feeds -->
    <script src="https://cdn.jsdelivr.net/npm/rss-parser@3.13.0/dist/rss-parser.min.js"></script>
</head>
<body>
    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal" style="display: none;">
        <div class="modal-content onboarding-content">
            <h2>üéì Benvenuto in Docente++</h2>
            <p class="onboarding-intro">Configura il tuo profilo per iniziare</p>
            
            <form id="onboarding-form">
                <div class="onboarding-section">
                    <h3>üë§ Dati Personali</h3>
                    <div class="form-group">
                        <label for="onboarding-first-name">Nome: *</label>
                        <input type="text" id="onboarding-first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-last-name">Cognome: *</label>
                        <input type="text" id="onboarding-last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-email">Email: *</label>
                        <input type="email" id="onboarding-email" required>
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3>üè´ Informazioni Scolastiche</h3>
                    <div class="form-group">
                        <label for="onboarding-school-level">Ordine di Scuola: *</label>
                        <select id="onboarding-school-level" required>
                            <option value="">Seleziona ordine di scuola</option>
                            <option value="infanzia">Scuola dell'Infanzia</option>
                            <option value="primaria">Scuola Primaria</option>
                            <option value="secondaria-I">Scuola Secondaria di I Grado</option>
                            <option value="secondaria-II">Scuola Secondaria di II Grado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-school-name">Nome Scuola:</label>
                        <input type="text" id="onboarding-school-name" placeholder="Nome dell'istituto">
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3>üìö Discipline</h3>
                    <div class="form-group">
                        <label for="onboarding-subjects">Seleziona o inserisci le tue discipline:</label>
                        <div class="subjects-container">
                            <div id="selected-subjects-display" class="selected-subjects"></div>
                            <input type="text" id="onboarding-subjects" placeholder="Scrivi una disciplina e premi Invio">
                            <div id="subjects-suggestions" class="subjects-suggestions"></div>
                        </div>
                        <small>Premi Invio o seleziona dalla lista per aggiungere una disciplina</small>
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3>üìÖ Anno Scolastico</h3>
                    <div class="form-group">
                        <label for="onboarding-school-year">Anno Scolastico: *</label>
                        <select id="onboarding-school-year" required>
                            <option value="">Seleziona anno scolastico</option>
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                            <option value="2026/2027">2026/2027</option>
                            <option value="2027/2028">2027/2028</option>
                            <option value="2028/2029">2028/2029</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-year-start">Data Inizio Anno:</label>
                        <input type="date" id="onboarding-year-start" value="2025-09-09">
                    </div>
                    <div class="form-group">
                        <label for="onboarding-year-end">Data Fine Anno:</label>
                        <input type="date" id="onboarding-year-end" value="2026-06-30">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Inizia ad Usare Docente++</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Format Selection Modal -->
    <div id="export-format-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>üì• Seleziona Formato di Esportazione</h2>
            <p id="export-description">Scegli il formato in cui desideri esportare i dati:</p>
            
            <div class="export-format-options">
                <div class="format-option" onclick="app.executeExport('json')">
                    <div class="format-icon">üìÑ</div>
                    <h3>JSON</h3>
                    <p>Formato dati strutturato, ideale per backup e importazione</p>
                </div>
                <div class="format-option" onclick="app.executeExport('pdf')">
                    <div class="format-icon">üìï</div>
                    <h3>PDF</h3>
                    <p>Documento formattato pronto per la stampa e condivisione</p>
                </div>
                <div class="format-option" onclick="app.executeExport('excel')">
                    <div class="format-icon">üìä</div>
                    <h3>Excel</h3>
                    <p>Foglio di calcolo per analisi avanzate (XLSX)</p>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeExportModal()">Annulla</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üéì Docente++</h1>
            <p class="subtitle">Gestione Didattica Potenziata da IA</p>
        </header>

        <div class="nav-container">
            <button class="menu-toggle" id="menu-toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <nav class="tabs" id="main-nav">
                <div class="menu-group">
                    <div class="menu-group-title">üìä Vista Generale</div>
                    <button class="tab-button active" data-tab="dashboard">Dashboard</button>
                </div>
                
                <div class="menu-group">
                    <div class="menu-group-title">üë®‚Äçüè´ In Classe</div>
                    <button class="tab-button" data-tab="lessons">Lezioni</button>
                    <button class="tab-button" data-tab="schedule">Orario</button>
                    <button class="tab-button" data-tab="evaluations">Valutazioni</button>
                </div>
                
                <div class="menu-group">
                    <div class="menu-group-title">üìã Pianificazione</div>
                    <button class="tab-button" data-tab="activities">Attivit√†</button>
                    <button class="tab-button" data-tab="notifications">Notifiche</button>
                    <button class="tab-button" data-tab="news">News</button>
                </div>
                
                <div class="menu-group">
                    <div class="menu-group-title">üë• Gestione</div>
                    <button class="tab-button" data-tab="students">Studenti</button>
                    <button class="tab-button" data-tab="classes">Classi</button>
                </div>
                
                <div class="menu-group">
                    <div class="menu-group-title">ü§ñ Strumenti IA</div>
                    <button class="tab-button" data-tab="ai-assistant">Assistente IA</button>
                    <button class="tab-button" data-tab="document-import">Importa con IA</button>
                </div>
                
                <div class="menu-group">
                    <div class="menu-group-title">‚öôÔ∏è Sistema</div>
                    <button class="tab-button" data-tab="settings">Impostazioni</button>
                </div>
            </nav>
        </div>
        
        <div class="menu-backdrop" id="menu-backdrop"></div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Dashboard</h2>
            <div class="class-selector-container">
                <label for="active-class-selector">üéØ Classe Attiva:</label>
                <select id="active-class-selector" onchange="app.setActiveClass(this.value)">
                    <option value="">Seleziona una classe</option>
                </select>
                <span id="current-class-display" class="current-class-badge">Nessuna classe selezionata</span>
            </div>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>üìö Lezioni Programmate</h3>
                    <p class="stat-number" id="lesson-count">0</p>
                    <p class="stat-label">Lezioni questa settimana</p>
                </div>
                <div class="card">
                    <h3>üë• Studenti</h3>
                    <p class="stat-number" id="student-count">0</p>
                    <p class="stat-label">Studenti totali</p>
                </div>
                <div class="card">
                    <h3>üìã Attivit√†</h3>
                    <p class="stat-number" id="activity-count">0</p>
                    <p class="stat-label">Attivit√† in corso</p>
                </div>
                <div class="card">
                    <h3>‚úÖ Valutazioni</h3>
                    <p class="stat-number" id="evaluation-count">0</p>
                    <p class="stat-label">Da completare</p>
                </div>
                <div class="card">
                    <h3>ü§ñ IA Attiva</h3>
                    <p class="stat-number" id="ai-status">‚úì</p>
                    <p class="stat-label">OpenRouter Ready</p>
                </div>
            </div>
            
            <!-- Today's Schedule Quick Access -->
            <div class="today-schedule-section" style="margin-top: 30px;">
                <h3>üìÖ Orario di Oggi</h3>
                <div id="today-schedule-preview"></div>
                <button class="btn btn-primary" onclick="app.goToTodaySchedule()" style="margin-top: 15px;">
                    üìã Vai all'Orario Completo
                </button>
            </div>
        </div>

        <!-- Lessons Tab -->
        <div id="lessons" class="tab-content">
            <h2>Gestione Lezioni</h2>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddLessonForm()">‚ûï Nuova Lezione</button>
                <button class="btn btn-secondary" onclick="app.generateLessonWithAI()">ü§ñ Genera con IA</button>
            </div>
            
            <div id="add-lesson-form" class="form-container" style="display: none;">
                <h3>Nuova Lezione</h3>
                <form id="lesson-form">
                    <div class="form-group">
                        <label for="lesson-title">Titolo:</label>
                        <input type="text" id="lesson-title" required>
                    </div>
                    <div class="form-group">
                        <label for="lesson-subject">Materia:</label>
                        <input type="text" id="lesson-subject" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lesson-date">Data:</label>
                            <input type="date" id="lesson-date" required>
                        </div>
                        <div class="form-group">
                            <label for="lesson-time">Ora:</label>
                            <input type="time" id="lesson-time" value="09:00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="lesson-description">Descrizione:</label>
                        <textarea id="lesson-description" rows="4"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddLessonForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="lessons-list" class="lessons-list"></div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content">
            <h2>üìÖ Orario Didattico</h2>
            <div class="schedule-info">
                <p>Gestisci il tuo orario settimanale. Clicca su una cella per assegnare una classe e un tipo di attivit√† (Teoria, Disegno, Laboratorio).</p>
                <p><small>Gli slot orari vanno dalle 8:00 alle 14:00, dal luned√¨ al venerd√¨. Sabato e domenica sono automaticamente esclusi.</small></p>
            </div>
            <div id="schedule-container"></div>
        </div>

        <!-- Activities Tab -->
        <div id="activities" class="tab-content">
            <h2>Gestione Attivit√† Didattiche</h2>
            
            <!-- Activities Summary Section -->
            <div id="activities-summary" class="summary-section" role="region" aria-label="Riepilogo statistiche attivit√†">
                <h3>Riepilogo Attivit√†</h3>
                <div class="summary-cards" role="group" aria-label="Statistiche attivit√† didattiche">
                    <div class="summary-card">
                        <div class="summary-icon">üìã</div>
                        <div class="summary-content">
                            <p class="summary-number" id="total-activities">0</p>
                            <p class="summary-label">Totali</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">üìÖ</div>
                        <div class="summary-content">
                            <p class="summary-number" id="planned-activities">0</p>
                            <p class="summary-label">Pianificate</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚ñ∂Ô∏è</div>
                        <div class="summary-content">
                            <p class="summary-number" id="inprogress-activities">0</p>
                            <p class="summary-label">In Corso</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚úÖ</div>
                        <div class="summary-content">
                            <p class="summary-number" id="completed-activities">0</p>
                            <p class="summary-label">Completate</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">‚ö†Ô∏è</div>
                        <div class="summary-content">
                            <p class="summary-number" id="overdue-activities">0</p>
                            <p class="summary-label">Scadute</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddActivityForm()">‚ûï Nuova Attivit√†</button>
                <select id="activity-filter" class="filter-select" onchange="app.renderActivities()">
                    <option value="all">Tutte le attivit√†</option>
                    <option value="planned">Pianificate</option>
                    <option value="in-progress">In corso</option>
                    <option value="completed">Completate</option>
                    <option value="lesson">Lezioni</option>
                    <option value="exercise">Esercitazioni</option>
                    <option value="lab">Laboratori</option>
                    <option value="project">Progetti</option>
                    <option value="homework">Compiti</option>
                    <option value="exam">Verifiche</option>
                </select>
            </div>
            
            <div id="add-activity-form" class="form-container" style="display: none;">
                <h3 id="activity-form-title">Nuova Attivit√†</h3>
                <form id="activity-form">
                    <input type="hidden" id="activity-edit-id">
                    <div class="form-group">
                        <label for="activity-title">Titolo: *</label>
                        <input type="text" id="activity-title" required>
                    </div>
                    <div class="form-group">
                        <label for="activity-type">Tipo di Attivit√†: *</label>
                        <select id="activity-type" required>
                            <option value="lesson">Lezione</option>
                            <option value="exercise">Esercitazione</option>
                            <option value="lab">Laboratorio</option>
                            <option value="project">Progetto</option>
                            <option value="homework">Compiti</option>
                            <option value="exam">Verifica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-priority">Priorit√†:</label>
                        <select id="activity-priority">
                            <option value="low">Bassa</option>
                            <option value="medium" selected>Media</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-description">Descrizione:</label>
                        <textarea id="activity-description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="activity-deadline">Scadenza:</label>
                        <input type="date" id="activity-deadline">
                    </div>
                    <div class="form-group">
                        <label for="activity-progress">Avanzamento (%):</label>
                        <input type="number" id="activity-progress" min="0" max="100" value="0">
                        <small>Percentuale di completamento dell'attivit√† (0-100)</small>
                    </div>
                    <div class="form-group">
                        <label for="activity-class">Assegna a Classe:</label>
                        <select id="activity-class">
                            <option value="">Nessuna (generale)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-student">Assegna a Studente:</label>
                        <select id="activity-student">
                            <option value="">Nessuno (tutta la classe)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-notes">Note/Feedback:</label>
                        <textarea id="activity-notes" rows="3" placeholder="Aggiungi note o feedback sull'attivit√†"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddActivityForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="activities-list" class="activities-list"></div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <h2>Gestione Studenti</h2>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddStudentForm()">‚ûï Nuovo Studente</button>
                <button class="btn btn-secondary" onclick="app.showImportStudentsDialog()">üì• Importa da File</button>
            </div>
            
            <div id="add-student-form" class="form-container" style="display: none;">
                <h3>Nuovo Studente</h3>
                <form id="student-form">
                    <div class="form-group">
                        <label for="student-name">Nome e Cognome:</label>
                        <input type="text" id="student-name" required>
                    </div>
                    <div class="form-group">
                        <label for="student-email">Email:</label>
                        <input type="email" id="student-email">
                    </div>
                    <div class="form-group">
                        <label for="student-class">Classe:</label>
                        <input type="text" id="student-class">
                    </div>
                    <div class="form-group">
                        <label for="student-birthdate">Data di Nascita:</label>
                        <input type="date" id="student-birthdate">
                    </div>
                    <div class="form-group">
                        <label for="student-nameday">Onomastico/Santo:</label>
                        <input type="text" id="student-nameday" placeholder="es. San Giovanni - 24 Giugno">
                    </div>
                    <div class="form-group">
                        <label for="student-notes">Note:</label>
                        <textarea id="student-notes" rows="2" placeholder="Note aggiuntive sullo studente"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddStudentForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="students-list" class="students-list"></div>
        </div>

        <!-- Classes Tab -->
        <div id="classes" class="tab-content">
            <h2>Gestione Classi</h2>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddClassForm()">‚ûï Nuova Classe</button>
            </div>
            
            <div id="add-class-form" class="form-container" style="display: none;">
                <h3 id="class-form-title">Nuova Classe</h3>
                <form id="class-form">
                    <input type="hidden" id="class-edit-id">
                    <div class="form-group">
                        <label for="class-name">Nome Classe: *</label>
                        <input type="text" id="class-name" placeholder="es. 1A, 2B, 3C" required>
                        <small>Inserisci il nome/sezione della classe</small>
                    </div>
                    <div class="form-group">
                        <label for="class-year">Anno di Corso:</label>
                        <select id="class-year">
                            <option value="">Seleziona anno</option>
                            <option value="1">1¬∞ Anno</option>
                            <option value="2">2¬∞ Anno</option>
                            <option value="3">3¬∞ Anno</option>
                            <option value="4">4¬∞ Anno</option>
                            <option value="5">5¬∞ Anno</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="class-section">Sezione:</label>
                        <input type="text" id="class-section" placeholder="es. A, B, C" maxlength="2">
                    </div>
                    <div class="form-group">
                        <label for="class-students-count">Numero Studenti:</label>
                        <input type="number" id="class-students-count" min="0" placeholder="es. 25">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddClassForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="classes-list" class="classes-list"></div>
        </div>

        <!-- Evaluations Tab -->
        <div id="evaluations" class="tab-content">
            <h2>Gestione Valutazioni</h2>
            
            <!-- Evaluation Criteria Section -->
            <div class="evaluation-section">
                <h3>üìã Criteri di Valutazione</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddCriterionForm()">‚ûï Nuovo Criterio</button>
                    <button class="btn btn-secondary" onclick="app.generateCriteriaWithAI()">ü§ñ Genera con IA</button>
                </div>

                <div id="add-criterion-form" class="form-container" style="display: none;">
                    <h4>Nuovo Criterio di Valutazione</h4>
                    <form id="criterion-form" onsubmit="event.preventDefault(); app.addCriterion();">
                        <div class="form-group">
                            <label for="criterion-name">Nome Criterio: *</label>
                            <input type="text" id="criterion-name" placeholder="es. Comprensione del testo" required>
                        </div>
                        <div class="form-group">
                            <label for="criterion-description">Descrizione:</label>
                            <textarea id="criterion-description" rows="3" placeholder="Descrivi il criterio di valutazione"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="criterion-subject">Disciplina:</label>
                            <input type="text" id="criterion-subject" placeholder="es. Italiano">
                        </div>
                        <div class="form-group">
                            <label for="criterion-type">Tipo:</label>
                            <select id="criterion-type">
                                <option value="">Seleziona tipo</option>
                                <option value="conoscenza">Conoscenza</option>
                                <option value="competenza">Competenza</option>
                                <option value="abilit√†">Abilit√†</option>
                                <option value="atteggiamento">Atteggiamento</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddCriterionForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="criteria-list" class="criteria-list"></div>
            </div>

            <!-- Evaluation Grids Section -->
            <div class="evaluation-section">
                <h3>üìä Griglie di Valutazione (Rubriche)</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddGridForm()">‚ûï Nuova Griglia</button>
                </div>

                <div id="add-grid-form" class="form-container" style="display: none;">
                    <h4>Nuova Griglia di Valutazione</h4>
                    <form id="grid-form" onsubmit="event.preventDefault(); app.addGrid();">
                        <div class="form-group">
                            <label for="grid-name">Nome Griglia: *</label>
                            <input type="text" id="grid-name" placeholder="es. Rubrica di Italiano" required>
                        </div>
                        <div class="form-group">
                            <label for="grid-description">Descrizione:</label>
                            <textarea id="grid-description" rows="3" placeholder="Descrivi la griglia di valutazione"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="grid-subject">Disciplina:</label>
                            <input type="text" id="grid-subject" placeholder="es. Italiano">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddGridForm()">Annulla</button>
                        </div>
                        <small>Nota: La griglia sar√† creata con 4 livelli di default (Eccellente, Buono, Sufficiente, Insufficiente)</small>
                    </form>
                </div>

                <div id="grids-list" class="grids-list"></div>
            </div>

            <!-- Evaluations Section -->
            <div class="evaluation-section">
                <h3>‚úÖ Valutazioni Assegnate</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddEvaluationForm()">‚ûï Nuova Valutazione</button>
                    <button class="btn btn-secondary" onclick="app.exportEvaluations()">üì• Esporta Valutazioni</button>
                </div>

                <div id="add-evaluation-form" class="form-container" style="display: none;">
                    <h4>Nuova Valutazione</h4>
                    <form id="evaluation-form" onsubmit="event.preventDefault(); app.addEvaluation();">
                        <div class="form-group">
                            <label for="evaluation-student">Studente:</label>
                            <select id="evaluation-student">
                                <option value="">Seleziona studente</option>
                            </select>
                            <small>Oppure seleziona una classe qui sotto</small>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-class">Classe:</label>
                            <select id="evaluation-class">
                                <option value="">Seleziona classe</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-criterion">Criterio:</label>
                            <select id="evaluation-criterion">
                                <option value="">Seleziona criterio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-grid">Griglia:</label>
                            <select id="evaluation-grid">
                                <option value="">Seleziona griglia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-subject">Disciplina:</label>
                            <select id="evaluation-subject">
                                <option value="">Seleziona disciplina</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-score">Voto (opzionale):</label>
                            <input type="number" id="evaluation-score" min="0" max="10" step="0.5" placeholder="es. 8">
                        </div>
                        <div class="form-group">
                            <label for="evaluation-date">Data:</label>
                            <input type="date" id="evaluation-date" value="">
                        </div>
                        <div class="form-group">
                            <label for="evaluation-notes">Note:</label>
                            <textarea id="evaluation-notes" rows="3" placeholder="Aggiungi note sulla valutazione"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddEvaluationForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="evaluations-list" class="evaluations-list"></div>
            </div>

            <!-- Assessment Results and Analytics Section -->
            <div class="evaluation-section">
                <h3>üìà Risultati e Statistiche</h3>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="app.toggleResultsView()">üîÑ Cambia Visualizzazione</button>
                </div>

                <div id="results-filters" class="filters-container">
                    <div class="filter-group">
                        <label for="filter-class">Filtra per Classe:</label>
                        <select id="filter-class" onchange="app.filterResults()">
                            <option value="">Tutte le classi</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-subject">Filtra per Disciplina:</label>
                        <select id="filter-subject" onchange="app.filterResults()">
                            <option value="">Tutte le discipline</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-student">Filtra per Studente:</label>
                        <select id="filter-student" onchange="app.filterResults()">
                            <option value="">Tutti gli studenti</option>
                        </select>
                    </div>
                </div>

                <div id="results-display" class="results-display"></div>
            </div>
        </div>

        <!-- News Tab -->
        <div id="news" class="tab-content">
            <h2>üì∞ News e Feed RSS/Atom</h2>
            <p class="section-description">
                Gestisci le tue fonti RSS/Atom e visualizza le news. Usa l'agente IA per analizzare le news e creare automaticamente attivit√†, scadenze e circolari.
            </p>

            <!-- RSS Feeds Management Section -->
            <div class="news-section">
                <h3>üì° Fonti RSS/Atom</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddFeedForm()">‚ûï Aggiungi Fonte RSS</button>
                    <button class="btn btn-secondary" onclick="app.refreshAllFeeds()">üîÑ Aggiorna Tutte</button>
                </div>

                <div id="add-feed-form" class="form-container" style="display: none;">
                    <h4>Aggiungi Fonte RSS/Atom</h4>
                    <form onsubmit="event.preventDefault(); app.addRSSFeed();">
                        <div class="form-group">
                            <label for="feed-name">Nome Fonte: *</label>
                            <input type="text" id="feed-name" placeholder="es. MIUR - Notizie" required>
                        </div>
                        <div class="form-group">
                            <label for="feed-url">URL Feed RSS/Atom: *</label>
                            <input type="url" id="feed-url" placeholder="https://esempio.com/feed.xml" required>
                            <small>Inserisci l'URL del feed RSS o Atom</small>
                        </div>
                        <div class="form-group">
                            <label for="feed-category">Categoria:</label>
                            <select id="feed-category">
                                <option value="istituzionale">Istituzionale</option>
                                <option value="normativa">Normativa</option>
                                <option value="didattica">Didattica</option>
                                <option value="circolari">Circolari</option>
                                <option value="altro">Altro</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Aggiungi</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddFeedForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="feeds-list" class="feeds-list"></div>
            </div>

            <!-- News List Section -->
            <div class="news-section">
                <h3>üìÑ Ultime News</h3>
                <div class="section-actions">
                    <div class="filter-group">
                        <label for="news-filter-source">Filtra per fonte:</label>
                        <select id="news-filter-source" onchange="app.filterNews()">
                            <option value="">Tutte le fonti</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="news-filter-category">Filtra per categoria:</label>
                        <select id="news-filter-category" onchange="app.filterNews()">
                            <option value="">Tutte le categorie</option>
                            <option value="istituzionale">Istituzionale</option>
                            <option value="normativa">Normativa</option>
                            <option value="didattica">Didattica</option>
                            <option value="circolari">Circolari</option>
                            <option value="altro">Altro</option>
                        </select>
                    </div>
                </div>

                <div id="news-list" class="news-list"></div>
            </div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="ai-assistant" class="tab-content">
            <h2>Assistente IA OpenRouter</h2>
            <div class="ai-container">
                <div class="ai-chat">
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-file-upload">
                        <label for="ai-file-input" class="file-upload-label">
                            üìé Allega file (PDF, immagini, txt, ecc.)
                        </label>
                        <input type="file" id="ai-file-input" accept=".pdf,.jpg,.jpeg,.png,.txt,.doc,.docx" onchange="app.handleFileSelect(event)">
                        <div id="selected-file-display" class="selected-file-display"></div>
                    </div>
                    <div class="chat-input-container">
                        <textarea id="ai-input" placeholder="Chiedi all'assistente IA di aiutarti con la pianificazione delle lezioni, idee didattiche, valutazioni..." rows="3"></textarea>
                        <button class="btn btn-primary" onclick="app.sendAIMessage()">Invia</button>
                    </div>
                </div>
                <div class="ai-suggestions">
                    <h3>Suggerimenti Rapidi</h3>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Genera un piano di lezione per matematica')">üìê Piano lezione matematica</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Crea esercizi per italiano')">‚úçÔ∏è Esercizi italiano</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Suggerisci attivit√† didattiche interattive')">üéØ Attivit√† interattive</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Genera criteri di valutazione')">üìä Criteri valutazione</button>
                </div>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content">
            <h2>üîî Notifiche e Promemoria</h2>
            
            <!-- Notifications Section -->
            <div class="notification-section">
                <div class="section-header" id="notifications-header">
                    <h3>üîî Notifiche Recenti</h3>
                </div>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="app.markAllNotificationsRead()">‚úì Segna tutte come lette</button>
                    <button class="btn btn-secondary" onclick="app.clearAllNotifications()">üóëÔ∏è Elimina tutte</button>
                </div>
                <!-- Filter section -->
                <div id="notifications-filter" class="notifications-filter"></div>
                <div id="notifications-list" class="notifications-list"></div>
            </div>

            <!-- Reminders Section -->
            <div class="reminder-section">
                <h3>‚è∞ Promemoria Personali</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddReminderForm()">‚ûï Nuovo Promemoria</button>
                </div>

                <div id="add-reminder-form" class="form-container" style="display: none;">
                    <h4>Crea Promemoria</h4>
                    <form onsubmit="event.preventDefault(); app.addReminder();">
                        <div class="form-group">
                            <label for="reminder-title">Titolo: *</label>
                            <input type="text" id="reminder-title" placeholder="Titolo del promemoria" required>
                        </div>
                        <div class="form-group">
                            <label for="reminder-message">Messaggio:</label>
                            <textarea id="reminder-message" placeholder="Descrizione del promemoria" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reminder-date">Data: *</label>
                                <input type="date" id="reminder-date" required>
                            </div>
                            <div class="form-group">
                                <label for="reminder-time">Ora: *</label>
                                <input type="time" id="reminder-time" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva Promemoria</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddReminderForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="reminders-list" class="reminders-list"></div>
            </div>

            <!-- Notification Settings Section -->
            <div class="notification-settings-section">
                <h3>‚öôÔ∏è Impostazioni Notifiche</h3>
                <form id="notification-settings-form" onsubmit="event.preventDefault(); app.saveNotificationSettings();">
                    <div class="settings-group">
                        <h4>Canali di Notifica</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-browser">
                                üåê Notifiche Browser
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-email" disabled>
                                üìß Notifiche Email (prossimamente)
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Promemoria Automatici</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-lesson-reminders">
                                üìö Promemoria per lezioni programmate
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-24h">
                                ‚è∞ Avviso 24 ore prima della lezione
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-1h">
                                ‚è∞ Avviso 1 ora prima della lezione
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-backup-reminders">
                                üíæ Promemoria backup periodici
                            </label>
                        </div>
                        <div class="form-group" style="margin-left: 25px;">
                            <label for="notification-backup-interval">Intervallo backup (giorni):</label>
                            <input type="number" id="notification-backup-interval" min="1" max="365" value="7" style="width: 100px;">
                            <small>Ricevi un promemoria ogni X giorni per eseguire un backup</small>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Orari Silenzio</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-quiet-hours">
                                üåô Abilita orari di silenzio
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="notification-quiet-start">Inizio:</label>
                                <input type="time" id="notification-quiet-start">
                            </div>
                            <div class="form-group">
                                <label for="notification-quiet-end">Fine:</label>
                                <input type="time" id="notification-quiet-end">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva Impostazioni</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Document Import Tab -->
        <div id="document-import" class="tab-content">
            <h2>üìÇ Importazione e Gestione Documenti con IA</h2>
            <p class="section-description">
                Carica documenti didattici e anagrafici. L'assistente IA ti aiuter√† a riconoscere e importare automaticamente i dati.
            </p>

            <!-- Quick Upload Section -->
            <div class="document-upload-section">
                <h3>üì§ Carica Documento</h3>
                <div class="upload-area" id="document-upload-area" onclick="document.getElementById('document-file-input').click()">
                    <div class="upload-icon">üìé</div>
                    <p><strong>Clicca per selezionare</strong> o trascina un file qui</p>
                    <p class="upload-formats">Formati supportati: CSV, XLSX, PDF, TXT, JSON</p>
                </div>
                <input type="file" id="document-file-input" accept=".csv,.xlsx,.xls,.pdf,.txt,.json" style="display: none;" onchange="app.handleDocumentUpload(event)">
                
                <div id="document-upload-status" class="upload-status" style="display: none;"></div>
            </div>

            <!-- AI Classification Section -->
            <div class="document-classification-section" id="document-classification" style="display: none;">
                <h3>ü§ñ Riconoscimento Automatico</h3>
                <div id="classification-result" class="classification-result"></div>
                <div id="classification-actions" class="classification-actions"></div>
            </div>

            <!-- Import Preview Section -->
            <div class="document-preview-section" id="document-preview" style="display: none;">
                <h3>üëÅÔ∏è Anteprima Dati da Importare</h3>
                <div id="preview-content" class="preview-content"></div>
                <div class="preview-actions">
                    <button class="btn btn-primary" onclick="app.confirmImport()">‚úÖ Conferma Importazione</button>
                    <button class="btn btn-secondary" onclick="app.cancelImport()">‚ùå Annulla</button>
                    <button class="btn btn-secondary" onclick="app.refineWithAI()">ü§ñ Affina con IA</button>
                </div>
            </div>

            <!-- Imported Documents History -->
            <div class="document-history-section">
                <h3>üìö Documenti Importati</h3>
                <div id="imported-documents-list" class="imported-documents-list"></div>
            </div>

            <!-- Audio Recording Section -->
            <div class="audio-recording-section">
                <h3>üéôÔ∏è Registrazione Audio Lezione</h3>
                <p class="section-description">Registra le tue lezioni per successive analisi e trascrizioni con l'IA</p>
                <div class="recording-controls">
                    <button class="btn btn-primary" id="start-recording-btn" onclick="app.startAudioRecording()">
                        üéôÔ∏è Avvia Registrazione
                    </button>
                    <button class="btn btn-danger" id="stop-recording-btn" onclick="app.stopAudioRecording()" style="display: none;">
                        ‚èπÔ∏è Ferma Registrazione
                    </button>
                    <div id="recording-timer" class="recording-timer" style="display: none;">
                        ‚è±Ô∏è <span id="timer-display">00:00</span>
                    </div>
                </div>
                <div id="recording-status" class="recording-status"></div>
                <div id="recordings-list" class="recordings-list"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Impostazioni</h2>
            <div class="settings-container">
                <form id="settings-form" onsubmit="event.preventDefault(); app.saveSettings();">
                    <h3>üë§ Profilo Docente</h3>
                    <div class="form-group">
                        <label for="teacher-first-name">Nome: *</label>
                        <input type="text" id="teacher-first-name" placeholder="Il tuo nome" autocomplete="given-name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-last-name">Cognome: *</label>
                        <input type="text" id="teacher-last-name" placeholder="Il tuo cognome" autocomplete="family-name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-email">Email: *</label>
                        <input type="email" id="teacher-email" placeholder="La tua email" autocomplete="email" required>
                    </div>

                    <h3 style="margin-top: 30px;">üè´ Informazioni Scolastiche</h3>
                    <div class="form-group">
                        <label for="school-level">Ordine di Scuola: *</label>
                        <select id="school-level" required>
                            <option value="">Seleziona ordine di scuola</option>
                            <option value="infanzia">Scuola dell'Infanzia</option>
                            <option value="primaria">Scuola Primaria</option>
                            <option value="secondaria-I">Scuola Secondaria di I Grado</option>
                            <option value="secondaria-II">Scuola Secondaria di II Grado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="school-name">Nome Scuola:</label>
                        <input type="text" id="school-name" placeholder="Nome della scuola" autocomplete="organization">
                    </div>

                    <h3 style="margin-top: 30px;">üìö Discipline</h3>
                    <div class="form-group">
                        <label for="teacher-subjects-settings">Le tue discipline:</label>
                        <div class="subjects-container">
                            <div id="selected-subjects-display-settings" class="selected-subjects"></div>
                            <input type="text" id="teacher-subjects-settings" placeholder="Scrivi una disciplina e premi Invio">
                            <div id="subjects-suggestions-settings" class="subjects-suggestions"></div>
                        </div>
                        <small>Premi Invio o seleziona dalla lista per aggiungere una disciplina</small>
                    </div>

                    <h3 style="margin-top: 30px;">üìÖ Anno Scolastico</h3>
                    <div class="form-group">
                        <label for="school-year">Anno Scolastico: *</label>
                        <select id="school-year" required>
                            <option value="">Seleziona anno scolastico</option>
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                            <option value="2026/2027">2026/2027</option>
                            <option value="2027/2028">2027/2028</option>
                            <option value="2028/2029">2028/2029</option>
                        </select>
                        <small>Seleziona l'anno scolastico di riferimento</small>
                    </div>
                    <div class="form-group">
                        <label for="school-year-start">Data Inizio Anno:</label>
                        <input type="date" id="school-year-start">
                        <small>Data di inizio dell'anno scolastico (es. 09/09/2025)</small>
                    </div>
                    <div class="form-group">
                        <label for="school-year-end">Data Fine Anno:</label>
                        <input type="date" id="school-year-end">
                        <small>Data di fine dell'anno scolastico (es. 30/06/2026)</small>
                    </div>

                    <h3 style="margin-top: 30px;">ü§ñ Integrazione IA</h3>
                    <div class="form-group">
                        <label for="openrouter-api-key">OpenRouter API Key:</label>
                        <div class="api-key-input-container">
                            <input type="password" id="openrouter-api-key" placeholder="Inserisci la tua API key" autocomplete="off">
                            <span id="api-key-status" class="api-key-status" title="Non verificata">‚ö™</span>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="app.verifyAPIKey()" style="margin-top: 10px;">üîç Verifica API Key</button>
                        <small>La chiave API viene salvata localmente nel browser</small>
                    </div>
                    <div class="form-group">
                        <label for="openrouter-model-id">Model ID:</label>
                        <input type="text" id="openrouter-model-id" placeholder="es. alibaba/tongyi-deepresearch-30b-a3b" autocomplete="off">
                        <small>ID del modello OpenRouter da utilizzare (default: alibaba/tongyi-deepresearch-30b-a3b)</small>
                    </div>

                    <button type="submit" class="btn btn-primary">Salva Impostazioni</button>
                </form>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="app.exportData()">üì• Esporta Dati</button>
                    <button class="btn btn-secondary" onclick="app.importData()">üì§ Importa Dati</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating AI Agent Button -->
    <div id="ai-fab" class="ai-fab" onclick="app.toggleAIAgentModal()" title="Apri Agente IA per analisi news">
        ü§ñ
    </div>

    <!-- AI Agent Modal for News Analysis -->
    <div id="ai-agent-modal" class="modal" style="display: none;">
        <div class="modal-content ai-agent-content">
            <div class="modal-header">
                <h2>ü§ñ Agente IA - Analisi Contestuale News</h2>
                <button class="close-btn" onclick="app.closeAIAgentModal()">‚úï</button>
            </div>
            
            <div class="ai-agent-body">
                <div class="form-group">
                    <label for="ai-agent-news-url">URL News da Analizzare:</label>
                    <input type="url" id="ai-agent-news-url" placeholder="https://esempio.com/news-articolo" />
                    <small>Inserisci l'URL della news per l'analisi contestuale</small>
                </div>

                <div class="form-group">
                    <label for="ai-agent-context">Richiesta Specifica (opzionale):</label>
                    <textarea id="ai-agent-context" rows="3" placeholder="es. Estrai le date importanti e crea promemoria per le scadenze"></textarea>
                    <small>Specifica cosa vuoi che l'agente analizzi o faccia</small>
                </div>

                <div class="ai-agent-suggestions">
                    <p><strong>Analisi disponibili:</strong></p>
                    <button class="suggestion-btn" onclick="app.setAIAgentPrompt('Estrai tutte le date e scadenze menzionate')">üìÖ Date e Scadenze</button>
                    <button class="suggestion-btn" onclick="app.setAIAgentPrompt('Identifica documenti e allegati da scaricare')">üìé Documenti</button>
                    <button class="suggestion-btn" onclick="app.setAIAgentPrompt('Estrai soggetti coinvolti e destinatari')">üë• Soggetti</button>
                    <button class="suggestion-btn" onclick="app.setAIAgentPrompt('Crea un riepilogo e proponi azioni da intraprendere')">üìã Riepilogo e Azioni</button>
                </div>

                <div class="ai-agent-results" id="ai-agent-results" style="display: none;">
                    <h4>üìä Risultati Analisi</h4>
                    <div id="ai-agent-results-content"></div>
                    
                    <div class="ai-agent-actions" id="ai-agent-actions" style="display: none;">
                        <h5>‚úÖ Azioni Proposte</h5>
                        <div id="ai-agent-proposed-actions"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" onclick="app.analyzeNewsWithAI()">üîç Analizza con IA</button>
                    <button class="btn btn-secondary" onclick="app.closeAIAgentModal()">Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates periodically (every 30 minutes)
                        setInterval(() => {
                            registration.update();
                        }, 1800000); // Check every 30 minutes
                        
                        // Also check for updates when the page becomes visible
                        document.addEventListener('visibilitychange', () => {
                            if (document.visibilityState === 'visible') {
                                registration.update();
                            }
                        });
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available, show update notification
                                    if (confirm('√à disponibile un aggiornamento dell\'app. Vuoi ricaricare?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('‚ùå Service Worker registration failed:', error);
                    });
            });
            
            // Handle service worker controller change
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button or notification
            console.log('üí° PWA pu√≤ essere installata!');
            
            // You can show a custom install button here
            // For now, we'll just log it
            showPWAInstallPrompt();
        });
        
        function showPWAInstallPrompt() {
            // Create a subtle notification for PWA installation
            const installPrompt = document.createElement('div');
            installPrompt.id = 'pwa-install-prompt';
            installPrompt.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #4a90e2;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 15px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                animation: slideUp 0.3s ease-out;
            `;
            
            installPrompt.innerHTML = `
                <span>üì± Installa Docente++ sul tuo dispositivo</span>
                <button id="pwa-install-btn" style="
                    background: white;
                    color: #4a90e2;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    font-weight: bold;
                    cursor: pointer;
                ">Installa</button>
                <button id="pwa-dismiss-btn" style="
                    background: transparent;
                    color: white;
                    border: 1px solid white;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                ">Dopo</button>
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from {
                        transform: translateX(-50%) translateY(100px);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(installPrompt);
            
            // Install button click
            document.getElementById('pwa-install-btn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to install prompt: ${outcome}`);
                    deferredPrompt = null;
                }
                installPrompt.remove();
            });
            
            // Dismiss button click
            document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
                installPrompt.remove();
            });
            
            // Auto-dismiss after 10 seconds
            setTimeout(() => {
                if (installPrompt.parentNode) {
                    installPrompt.remove();
                }
            }, 10000);
        }
        
        // Track when the app is installed
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA installata con successo!');
            deferredPrompt = null;
        });
    </script>
</body>
</html>
